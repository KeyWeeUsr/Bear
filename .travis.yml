sudo: required

language: python
os:
    - linux
    - osx

python:
    - "3.6"

script: echo Why Travis, why

jobs:
    include:
        - stage: style
          script:
              - if [[ "$TRAVIS_OS_NAME" == "osx" ]];
                then
                    curl -LO https://www.python.org/ftp/python/3.6.8/python-3.6.8-macosx10.6.pkg;
                    sudo installer -package python-3.6.8-macosx10.6.pkg -target /;
                    curl https://bootstrap.pypa.io/get-pip.py | python3;
                fi
              - pip3 install --editable .[ci,dev]
              - python3 check.py
              - coveralls || true
        - stage: deploy
          script:
              - if [[ "$TRAVIS_OS_NAME" == "osx" ]];
                then
                    curl -LO https://www.python.org/ftp/python/3.6.8/python-3.6.8-macosx10.6.pkg;
                    sudo installer -package python-3.6.8-macosx10.6.pkg -target /;
                    curl https://bootstrap.pypa.io/get-pip.py | python3;
                fi
              - python3 release.py

stages:
    - name: style
      if: NOT (type = api)
    - name: deploy
      if: (branch = master) AND (NOT (type IN (push, pull_request)))
    - name: test
      if: branch = "randomtravisbugstagethatdoesnotworkandcrasheseverything:-)"
